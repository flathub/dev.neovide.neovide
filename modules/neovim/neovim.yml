name: neovim
modules:
  - python3-pynvim.yaml
  - name: wl-clipboard
    buildsystem: meson
    config-opts:
      - -Dzshcompletiondir=no
      - -Dfishcompletiondir=no
    sources:
      - type: archive
        url: https://github.com/bugaevc/wl-clipboard/archive/v2.2.1.tar.gz
        sha256: 6eb8081207fb5581d1d82c4bcd9587205a31a3d47bea3ebeb7f41aa1143783eb
        x-checker-data:
          type: anitya
          project-id: 49082
          url-template: https://github.com/bugaevc/wl-clipboard/archive/v$version.tar.gz
  - name: xclip
    sources:
      - type: archive
        url: https://github.com/astrand/xclip/archive/0.13.tar.gz
        sha256: ca5b8804e3c910a66423a882d79bf3c9450b875ac8528791fb60ec9de667f758
    modules:
      - name: libXmu
        config-opts:
          - --disable-static
          - --disable-docs
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libXmu-1.1.3.tar.bz2
            sha256: 9c343225e7c3dc0904f2122b562278da5fed639b1b5e880d25111561bac5b731
  - name: LuaJIT
    no-autogen: true
    make-args:
      - PREFIX=/app
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: https://github.com/luajit/luajit/archive/fdf2379ccba1eb68ff07f8bc48541568f5bbdfbf.tar.gz
        sha256: 4f3fcc8a9a685ec2c449824b26d7c5f4b9c7faff851915cf13e68fb740c25048
    cleanup:
      - /bin
  - name: lpeg
    no-autogen: true
    no-make-install: true
    make-args:
      - LUADIR=/app/include/luajit-2.1/
    post-install:
      - install -Dm755 -t /app/lib/lua/5.1/ lpeg.so
      - install -Dm644 -t /app/share/lua/5.1/ re.lua
    sources:
      - type: archive
        url: https://github.com/neovim/deps/raw/d495ee6f79e7962a53ad79670cb92488abe0b9b4/opt/lpeg-1.1.0.tar.gz
        sha256: 4b155d67d2246c1ffa7ad7bc466c1ea899bbc40fef0257cc9c03cecbaed4352a
  - name: mpack-lua
    no-autogen: true
    make-args:
      - USE_SYSTEM_MPACK=yes
      - LUA_INCLUDE=-I/app/include/luajit-2.1/
    make-install-args:
      - USE_SYSTEM_MPACK=yes
    sources:
      - type: archive
        url: https://github.com/libmpack/libmpack-lua/archive/1.0.13.tar.gz
        sha256: 436a6a3973207403d3f20082002c32e74c25d9149ff2516dc06b0b41514044bf
      - type: shell
        commands:
          - sed -i 's|/usr/lib|/app/lib|' ./Makefile
    cleanup:
      - '*'
    modules:
      - name: mpack
        no-autogen: true
        make-install-args:
          - PREFIX=/app
        sources:
          - type: archive
            url: https://github.com/libmpack/libmpack/archive/1.0.5.tar.gz
            sha256: 4ce91395d81ccea97d3ad4cb962f8540d166e59d3e2ddce8a22979b49f108956
        cleanup:
          - '*'
  - name: luv
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_MODULE=OFF
      - -DBUILD_SHARED_LIBS=ON
      - -DWITH_SHARED_LIBUV=ON
      - -DLUA_BUILD_TYPE=System
    sources:
      - type: archive
        url: https://github.com/luvit/luv/releases/download/1.51.0-1/luv-1.51.0-1.tar.gz
        sha256: dc706d9141c185bdce08b6fc8a9d4df05c3ac3676809ee4e9e37e1553d821237
        x-checker-data:
          type: anitya
          project-id: 21510
          url-template: https://github.com/luvit/luv/releases/download/$version/luv-$version.tar.gz
    modules:
      - name: libuv
        sources:
          - type: archive
            url: https://github.com/libuv/libuv/archive/v1.51.0.tar.gz
            sha256: 27e55cf7083913bfb6826ca78cde9de7647cded648d35f24163f2d31bb9f51cd
            x-checker-data:
              type: anitya
              project-id: 10784
              url-template: https://github.com/libuv/libuv/archive/v$version.tar.gz
  - name: msgpack-c
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/msgpack/msgpack-c/releases/download/c-6.1.0/msgpack-c-6.1.0.tar.gz
        sha256: 674119f1a85b5f2ecc4c7d5c2859edf50c0b05e0c10aa0df85eefa2c8c14b796
  - name: unibilium
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: https://github.com/neovim/unibilium/archive/v2.1.1.tar.gz
        sha256: 6f0ee21c8605340cfbb458cbd195b4d074e6d16dd0c0e12f2627ca773f3cabf1
  - name: libvterm
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: https://github.com/neovim/libvterm/archive/0a15c6e983b0db7ef8276e0792414a805d01bdaf.tar.gz
        sha256: c4683e7a2d71c04781fd0ab7719a94202800e97a9e091514c16983bb732b0fa7
    cleanup:
      - /bin
  - name: libtermkey
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: http://www.leonerd.org.uk/code/libtermkey/libtermkey-0.22.tar.gz
        sha256: 6945bd3c4aaa83da83d80a045c5563da4edd7d0374c62c0d35aec09eb3014600
  - name: tree-sitter
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: https://github.com/tree-sitter/tree-sitter/archive/v0.25.9.tar.gz
        sha256: 024a2478579acebbb8882d7c2c0f0e07fc0aa19a459b48d10469e4abb96cf16e
        x-checker-data:
          type: anitya
          project-id: 142464
          url-template: https://github.com/tree-sitter/tree-sitter/archive/v$version.tar.gz
  - name: utf8proc
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=OFF
      - -DUTF8PROC_INSTALL=ON
      - -DUTF8PROC_ENABLE_TESTING=OFF
    builddir: true
    sources:
      - type: git
        url: https://github.com/JuliaStrings/utf8proc.git
        tag: v2.11.2
        commit: 90daf9f396cfec91668758eb9cc54bd5248a6b89
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: neovim
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DUSE_BUNDLED=OFF
    sources:
      - type: archive
        url: https://github.com/neovim/neovim/archive/v0.11.5.tar.gz
        sha256: c63450dfb42bb0115cd5e959f81c77989e1c8fd020d5e3f1e6d897154ce8b771
        x-checker-data:
          is-main-source: true
          type: anitya
          project-id: 9037
          url-template: https://github.com/neovim/neovim/archive/v$version.tar.gz
      - type: file
        path: ../../doc/flatpak.txt
        dest: runtime/doc/flatpak.txt
      - type: patch
        path: intro.patch

